!function(e,t){"use strict";function n(){r.READY||(T.determineEventTypes(),E.each(r.gestures,function(e){M.register(e)}),T.onTouch(r.DOCUMENT,d,M.detect),T.onTouch(r.DOCUMENT,g,M.detect),r.READY=!0)}var r=function y(e,t){return new y.Instance(e,t||{})};r.VERSION="1.1.3",r.defaults={behavior:{userSelect:"none",touchAction:"pan-y",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},r.DOCUMENT=document,r.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,r.HAS_TOUCHEVENTS="ontouchstart"in e,r.IS_MOBILE=/mobile|tablet|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent),r.NO_MOUSEEVENTS=r.HAS_TOUCHEVENTS&&r.IS_MOBILE||r.HAS_POINTEREVENTS,r.CALCULATE_INTERVAL=25;var i={},a=r.DIRECTION_DOWN="down",o=r.DIRECTION_LEFT="left",s=r.DIRECTION_UP="up",c=r.DIRECTION_RIGHT="right",u=r.POINTER_MOUSE="mouse",l=r.POINTER_TOUCH="touch",h=r.POINTER_PEN="pen",p=r.EVENT_START="start",d=r.EVENT_MOVE="move",g=r.EVENT_END="end",f=r.EVENT_RELEASE="release",v=r.EVENT_TOUCH="touch";r.READY=!1,r.plugins=r.plugins||{},r.gestures=r.gestures||{};var E=r.utils={extend:function(e,n,r){for(var i in n)!n.hasOwnProperty(i)||e[i]!==t&&r||(e[i]=n[i]);return e},on:function(e,t,n){e.addEventListener(t,n,!1)},off:function(e,t,n){e.removeEventListener(t,n,!1)},each:function(e,n,r){var i,a;if("forEach"in e)e.forEach(n,r);else if(e.length!==t){for(i=0,a=e.length;a>i;i++)if(n.call(r,e[i],i,e)===!1)return}else for(i in e)if(e.hasOwnProperty(i)&&n.call(r,e[i],i,e)===!1)return},inStr:function(e,t){return e.indexOf(t)>-1},inArray:function(e,t){if(e.indexOf){var n=e.indexOf(t);return-1===n?!1:n}for(var r=0,i=e.length;i>r;r++)if(e[r]===t)return r;return!1},toArray:function(e){return Array.prototype.slice.call(e,0)},hasParent:function(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1},getCenter:function(e){var t=[],n=[],r=[],i=[],a=Math.min,o=Math.max;return 1===e.length?{pageX:e[0].pageX,pageY:e[0].pageY,clientX:e[0].clientX,clientY:e[0].clientY}:(E.each(e,function(e){t.push(e.pageX),n.push(e.pageY),r.push(e.clientX),i.push(e.clientY)}),{pageX:(a.apply(Math,t)+o.apply(Math,t))/2,pageY:(a.apply(Math,n)+o.apply(Math,n))/2,clientX:(a.apply(Math,r)+o.apply(Math,r))/2,clientY:(a.apply(Math,i)+o.apply(Math,i))/2})},getVelocity:function(e,t,n){return{x:Math.abs(t/e)||0,y:Math.abs(n/e)||0}},getAngle:function(e,t){var n=t.clientX-e.clientX,r=t.clientY-e.clientY;return 180*Math.atan2(r,n)/Math.PI},getDirection:function(e,t){var n=Math.abs(e.clientX-t.clientX),r=Math.abs(e.clientY-t.clientY);return n>=r?e.clientX-t.clientX>0?o:c:e.clientY-t.clientY>0?s:a},getDistance:function(e,t){var n=t.clientX-e.clientX,r=t.clientY-e.clientY;return Math.sqrt(n*n+r*r)},getScale:function(e,t){return e.length>=2&&t.length>=2?this.getDistance(t[0],t[1])/this.getDistance(e[0],e[1]):1},getRotation:function(e,t){return e.length>=2&&t.length>=2?this.getAngle(t[1],t[0])-this.getAngle(e[1],e[0]):0},isVertical:function(e){return e==s||e==a},setPrefixedCss:function(e,t,n,r){var i=["","Webkit","Moz","O","ms"];t=E.toCamelCase(t);for(var a=0;a<i.length;a++){var o=t;if(i[a]&&(o=i[a]+o.slice(0,1).toUpperCase()+o.slice(1)),o in e.style){e.style[o]=(null==r||r)&&n||"";break}}},toggleBehavior:function(e,t,n){if(t&&e&&e.style){E.each(t,function(t,r){E.setPrefixedCss(e,r,t,n)});var r=n&&function(){return!1};"none"==t.userSelect&&(e.onselectstart=r),"none"==t.userDrag&&(e.ondragstart=r)}},toCamelCase:function(e){return e.replace(/[_-]([a-z])/g,function(e){return e[1].toUpperCase()})}},T=r.event={preventMouseEvents:!1,started:!1,shouldDetect:!1,on:function(e,t,n,r){var i=t.split(" ");E.each(i,function(t){E.on(e,t,n),r&&r(t)})},off:function(e,t,n,r){var i=t.split(" ");E.each(i,function(t){E.off(e,t,n),r&&r(t)})},onTouch:function(e,t,n){var a=this,o=function(i){var o,s=i.type.toLowerCase(),c=r.HAS_POINTEREVENTS,u=E.inStr(s,"mouse");u&&a.preventMouseEvents||(u&&t==p&&0===i.button?(a.preventMouseEvents=!1,a.shouldDetect=!0):c&&t==p?a.shouldDetect=1===i.buttons||m.matchType(l,i):u||t!=p||(a.preventMouseEvents=!0,a.shouldDetect=!0),c&&t!=g&&m.updatePointer(t,i),a.shouldDetect&&(o=a.doDetect.call(a,i,t,e,n)),o==g&&(a.preventMouseEvents=!1,a.shouldDetect=!1,m.reset()),c&&t==g&&m.updatePointer(t,i))};return this.on(e,i[t],o),o},doDetect:function(e,t,n,r){var i=this.getTouchList(e,t),a=i.length,o=t,s=i.trigger,c=a;t==p?s=v:t==g&&(s=f,c=i.length-(e.changedTouches?e.changedTouches.length:1)),c>0&&this.started&&(o=d),this.started=!0;var u=this.collectEventData(n,o,i,e);return t!=g&&r.call(M,u),s&&(u.changedLength=c,u.eventType=s,r.call(M,u),u.eventType=o,delete u.changedLength),o==g&&(r.call(M,u),this.started=!1),o},determineEventTypes:function(){var t;return t=r.HAS_POINTEREVENTS?e.PointerEvent?["pointerdown","pointermove","pointerup pointercancel lostpointercapture"]:["MSPointerDown","MSPointerMove","MSPointerUp MSPointerCancel MSLostPointerCapture"]:r.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],i[p]=t[0],i[d]=t[1],i[g]=t[2],i},getTouchList:function(e,t){if(r.HAS_POINTEREVENTS)return m.getTouchList();if(e.touches){if(t==d)return e.touches;var n=[],i=[].concat(E.toArray(e.touches),E.toArray(e.changedTouches)),a=[];return E.each(i,function(e){E.inArray(n,e.identifier)===!1&&a.push(e),n.push(e.identifier)}),a}return e.identifier=1,[e]},collectEventData:function(e,t,n,r){var i=l;return E.inStr(r.type,"mouse")||m.matchType(u,r)?i=u:m.matchType(h,r)&&(i=h),{center:E.getCenter(n),timeStamp:Date.now(),target:r.target,touches:n,eventType:t,pointerType:i,srcEvent:r,preventDefault:function(){var e=this.srcEvent;e.preventManipulation&&e.preventManipulation(),e.preventDefault&&e.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return M.stopDetect()}}}},m=r.PointerEvent={pointers:{},getTouchList:function(){var e=[];return E.each(this.pointers,function(t){e.push(t)}),e},updatePointer:function(e,t){e==g?delete this.pointers[t.pointerId]:(t.identifier=t.pointerId,this.pointers[t.pointerId]=t)},matchType:function(e,t){if(!t.pointerType)return!1;var n=t.pointerType,r={};return r[u]=n===(t.MSPOINTER_TYPE_MOUSE||u),r[l]=n===(t.MSPOINTER_TYPE_TOUCH||l),r[h]=n===(t.MSPOINTER_TYPE_PEN||h),r[e]},reset:function(){this.pointers={}}},M=r.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(e,t){this.current||(this.stopped=!1,this.current={inst:e,startEvent:E.extend({},t),lastEvent:!1,lastCalcEvent:!1,futureCalcEvent:!1,lastCalcData:{},name:""},this.detect(t))},detect:function(e){if(this.current&&!this.stopped){e=this.extendEventData(e);var t=this.current.inst,n=t.options;return E.each(this.gestures,function(r){!this.stopped&&t.enabled&&n[r.name]&&r.handler.call(r,e,t)},this),this.current&&(this.current.lastEvent=e),e.eventType==g&&this.stopDetect(),e}},stopDetect:function(){this.previous=E.extend({},this.current),this.current=null,this.stopped=!0},getCalculatedData:function(e,t,n,i,a){var o=this.current,s=!1,c=o.lastCalcEvent,u=o.lastCalcData;c&&e.timeStamp-c.timeStamp>r.CALCULATE_INTERVAL&&(t=c.center,n=e.timeStamp-c.timeStamp,i=e.center.clientX-c.center.clientX,a=e.center.clientY-c.center.clientY,s=!0),(e.eventType==v||e.eventType==f)&&(o.futureCalcEvent=e),(!o.lastCalcEvent||s)&&(u.velocity=E.getVelocity(n,i,a),u.angle=E.getAngle(t,e.center),u.direction=E.getDirection(t,e.center),o.lastCalcEvent=o.futureCalcEvent||e,o.futureCalcEvent=e),e.velocityX=u.velocity.x,e.velocityY=u.velocity.y,e.interimAngle=u.angle,e.interimDirection=u.direction},extendEventData:function(e){var t=this.current,n=t.startEvent,r=t.lastEvent||n;(e.eventType==v||e.eventType==f)&&(n.touches=[],E.each(e.touches,function(e){n.touches.push({clientX:e.clientX,clientY:e.clientY})}));var i=e.timeStamp-n.timeStamp,a=e.center.clientX-n.center.clientX,o=e.center.clientY-n.center.clientY;return this.getCalculatedData(e,r.center,i,a,o),E.extend(e,{startEvent:n,deltaTime:i,deltaX:a,deltaY:o,distance:E.getDistance(n.center,e.center),angle:E.getAngle(n.center,e.center),direction:E.getDirection(n.center,e.center),scale:E.getScale(n.touches,e.touches),rotation:E.getRotation(n.touches,e.touches)}),e},register:function(e){var n=e.defaults||{};return n[e.name]===t&&(n[e.name]=!0),E.extend(r.defaults,n,!0),e.index=e.index||1e3,this.gestures.push(e),this.gestures.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this.gestures}};r.Instance=function(e,t){var i=this;n(),this.element=e,this.enabled=!0,E.each(t,function(e,n){delete t[n],t[E.toCamelCase(n)]=e}),this.options=E.extend(E.extend({},r.defaults),t||{}),this.options.behavior&&E.toggleBehavior(this.element,this.options.behavior,!0),this.eventStartHandler=T.onTouch(e,p,function(e){i.enabled&&e.eventType==p?M.startDetect(i,e):e.eventType==v&&M.detect(e)}),this.eventHandlers=[]},r.Instance.prototype={on:function(e,t){var n=this;return T.on(n.element,e,t,function(e){n.eventHandlers.push({gesture:e,handler:t})}),n},off:function(e,t){var n=this;return T.off(n.element,e,t,function(e){var r=E.inArray({gesture:e,handler:t});r!==!1&&n.eventHandlers.splice(r,1)}),n},trigger:function(e,t){t||(t={});var n=r.DOCUMENT.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t;var i=this.element;return E.hasParent(t.target,i)&&(i=t.target),i.dispatchEvent(n),this},enable:function(e){return this.enabled=e,this},dispose:function(){var e,t;for(E.toggleBehavior(this.element,this.options.behavior,!1),e=-1;t=this.eventHandlers[++e];)E.off(this.element,t.gesture,t.handler);return this.eventHandlers=[],T.off(this.element,i[p],this.eventStartHandler),null}},function(e){function t(t,r){var i=M.current;if(!(r.options.dragMaxTouches>0&&t.touches.length>r.options.dragMaxTouches))switch(t.eventType){case p:n=!1;break;case d:if(t.distance<r.options.dragMinDistance&&i.name!=e)return;var u=i.startEvent.center;if(i.name!=e&&(i.name=e,r.options.dragDistanceCorrection&&t.distance>0)){var l=Math.abs(r.options.dragMinDistance/t.distance);u.pageX+=t.deltaX*l,u.pageY+=t.deltaY*l,u.clientX+=t.deltaX*l,u.clientY+=t.deltaY*l,t=M.extendEventData(t)}(i.lastEvent.dragLockToAxis||r.options.dragLockToAxis&&r.options.dragLockMinDistance<=t.distance)&&(t.dragLockToAxis=!0);var h=i.lastEvent.direction;t.dragLockToAxis&&h!==t.direction&&(t.direction=E.isVertical(h)?t.deltaY<0?s:a:t.deltaX<0?o:c),n||(r.trigger(e+"start",t),n=!0),r.trigger(e,t),r.trigger(e+t.direction,t);var v=E.isVertical(t.direction);(r.options.dragBlockVertical&&v||r.options.dragBlockHorizontal&&!v)&&t.preventDefault();break;case f:n&&t.changedLength<=r.options.dragMaxTouches&&(r.trigger(e+"end",t),n=!1);break;case g:n=!1}}var n=!1;r.gestures.Drag={name:e,index:50,handler:t,defaults:{dragMinDistance:10,dragDistanceCorrection:!0,dragMaxTouches:1,dragBlockHorizontal:!1,dragBlockVertical:!1,dragLockToAxis:!1,dragLockMinDistance:25}}}("drag"),r.gestures.Gesture={name:"gesture",index:1337,handler:function(e,t){t.trigger(this.name,e)}},function(e){function t(t,r){var i=r.options,a=M.current;switch(t.eventType){case p:clearTimeout(n),a.name=e,n=setTimeout(function(){a&&a.name==e&&r.trigger(e,t)},i.holdTimeout);break;case d:t.distance>i.holdThreshold&&clearTimeout(n);break;case f:clearTimeout(n)}}var n;r.gestures.Hold={name:e,index:10,defaults:{holdTimeout:500,holdThreshold:2},handler:t}}("hold"),r.gestures.Release={name:"release",index:1/0,handler:function(e,t){e.eventType==f&&t.trigger(this.name,e)}},r.gestures.Swipe={name:"swipe",index:40,defaults:{swipeMinTouches:1,swipeMaxTouches:1,swipeVelocityX:.6,swipeVelocityY:.6},handler:function(e,t){if(e.eventType==f){var n=e.touches.length,r=t.options;if(n<r.swipeMinTouches||n>r.swipeMaxTouches)return;(e.velocityX>r.swipeVelocityX||e.velocityY>r.swipeVelocityY)&&(t.trigger(this.name,e),t.trigger(this.name+e.direction,e))}}},function(e){function t(t,r){var i,a,o=r.options,s=M.current,c=M.previous;switch(t.eventType){case p:n=!1;break;case d:n=n||t.distance>o.tapMaxDistance;break;case g:!E.inStr(t.srcEvent.type,"cancel")&&t.deltaTime<o.tapMaxTime&&!n&&(i=c&&c.lastEvent&&t.timeStamp-c.lastEvent.timeStamp,a=!1,c&&c.name==e&&i&&i<o.doubleTapInterval&&t.distance<o.doubleTapDistance&&(r.trigger("doubletap",t),a=!0),(!a||o.tapAlways)&&(s.name=e,r.trigger(s.name,t)))}}var n=!1;r.gestures.Tap={name:e,index:100,handler:t,defaults:{tapMaxTime:250,tapMaxDistance:10,tapAlways:!0,doubleTapDistance:20,doubleTapInterval:300}}}("tap"),r.gestures.Touch={name:"touch",index:-1/0,defaults:{preventDefault:!1,preventMouse:!1},handler:function(e,t){return t.options.preventMouse&&e.pointerType==u?void e.stopDetect():(t.options.preventDefault&&e.preventDefault(),void(e.eventType==v&&t.trigger("touch",e)))}},function(e){function t(t,r){switch(t.eventType){case p:n=!1;break;case d:if(t.touches.length<2)return;var i=Math.abs(1-t.scale),a=Math.abs(t.rotation);if(i<r.options.transformMinScale&&a<r.options.transformMinRotation)return;M.current.name=e,n||(r.trigger(e+"start",t),n=!0),r.trigger(e,t),a>r.options.transformMinRotation&&r.trigger("rotate",t),i>r.options.transformMinScale&&(r.trigger("pinch",t),r.trigger("pinch"+(t.scale<1?"in":"out"),t));break;case f:n&&t.changedLength<2&&(r.trigger(e+"end",t),n=!1)}}var n=!1;r.gestures.Transform={name:e,index:45,defaults:{transformMinScale:.01,transformMinRotation:1},handler:t}}("transform"),"function"==typeof define&&define.amd?define(function(){return r}):"undefined"!=typeof module&&module.exports?module.exports=r:e.Hammer=r}(window);
!function(){var t={systeminfo:null,lowThreshold:.04,listenBatteryLowState:function(){var t=this;this.systeminfo.addPropertyValueChangeListener("BATTERY",function(t){t.isCharging||tizen.application.getCurrentApplication().exit()},{lowThreshold:t.lowThreshold})},checkBatteryLowState:function(){var t=this;this.systeminfo.getPropertyValue("BATTERY",function(e){e.level<t.lowThreshold&&!e.isCharging&&tizen.application.getCurrentApplication().exit()},null)},init:function(){"object"==typeof tizen&&"object"==typeof tizen.systeminfo?(this.systeminfo=tizen.systeminfo,this.checkBatteryLowState(),this.listenBatteryLowState()):console.warn("tizen.systeminfo is not available.")}};t.init()}();
function gameLoop(){Game.process((new Date).getTime()),Game.draw();var e=30;setTimeout(function(){window.requestAnimationFrame(gameLoop)},1e3/e)}function hookUpBrowseKeyPress(){document.onkeydown=function(e){37==e.keyCode&&Game.alterDirection(Direction.Left),38==e.keyCode&&Game.alterDirection(Direction.Up),39==e.keyCode&&Game.alterDirection(Direction.Right),40==e.keyCode&&Game.alterDirection(Direction.Down)}}var Config={pauseTextColor:"#ffffff",gameOverTextColor:"#ff5f5f",highScoreColor:"#00ff00",nonHighScoreColor:"#ffff00",textStroke:"blue"},Game={self:this,canvas:null,context:null,grid:null,snakeBoard:null,snake:null,snakeBlockSize:16,nextMove:void 0,gridDrawer:void 0,gameFps:8,drawables:new ListDrawable,gameDrawables:new ListDrawable,isChrome:!1,init:function(){this.isChrome=window.chrome,this.establishFonts(),this.mspf=1e3/this.gameFps;var e=this.drawables,t=this.snakeBlockSize;e.add(new GridDrawable({color:"#00007f",size:t})),e.add(new GridDrawable({color:"#00008f",size:4*t})),e.add(new GridDrawable({color:"#00009f",size:8*t})),e.add(this.gameDrawables);var i=t,a=new Bitmap(i,i);a.load(16==t?"apple_16.png":"apple_32.png"),this.appleDrawable=a;var i=t-1,a=new Bitmap(i,i),o=a.context;o.fillStyle="#00ff00",o.beginPath(),o.moveTo(0,i),o.lineTo(i,i),o.lineTo(i/2,0),o.fill(),this.livesDrawable=a,this.localData=new LocalData,this.highscore=new HighScore(this.localData),this.newGame(),this.stick=new ControlStickDrawable,this.stick.setDrawPosition(160,160),this.hookUpSwipes(this.canvas,this),this.isChrome&&null!==this.watch&&this.hookUpSwipes(this.watch,this),this.controlOffset=10+this.stick.getOuterRadius(),this.snakeBoard.pause()},clear:function(){var e=this.context;e.fillStyle="black",e.fillRect(0,0,this.context.canvas.width,this.context.canvas.height)},hookUpSwipes:function(e,t){var i=this,a=t.stick;Hammer(e).on("dragend",function(){a.setPosition(0,0)}),Hammer(e).on("doubletap",function(){i.newGameIfDead()}),Hammer(e).on("drag",function(e){var t=.5;if(a.setPosition(e.gesture.deltaX*t,e.gesture.deltaY*t)){var o=e.gesture.direction;"up"==o?i.alterDirection(Direction.Up):"down"==o?i.alterDirection(Direction.Down):"left"==o?i.alterDirection(Direction.Left):"right"==o&&i.alterDirection(Direction.Right)}})},newGame:function(){var e=this.gameDrawables;e.clear(),this.snakeBoard=null;var t=this.localData.read("game");if(null!=t){this.localData.write("game",null);try{this.snakeBoard=(new GameSerializer).deserialize(t)}catch(i){this.snakeBoard=null}}if(null===this.snakeBoard){var a={boardWidth:Math.ceil(320/this.snakeBlockSize),boardHeight:Math.ceil(320/this.snakeBlockSize),initialSize:10};this.snakeBoard=new SnakeGame(a)}this.snake=this.snakeBoard.snake,this.gridDrawer=new GridDrawer(this.snakeBlockSize,{width:this.snakeBoard.boardWidth,height:this.snakeBoard.boardHeight});var o=this.gridDrawer;e.add(new SnakeDrawable(this.snake,o)),e.add(new ApplesDrawable(this.snakeBoard,o,this.appleDrawable)),0==this.snakeBoard.countApples()&&this.snakeBoard.placeNApples(10)},newGameIfDead:function(){this.snakeBoard.isDead()&&this.newGame()},alterDirection:function(e){this.snakeBoard.isDead()||this.snakeBoard.setDirection(e)&&this.snakeBoard.resume()},process:function(e){var t=this.mspf;if(void 0!=this.nextMove){var i=this.nextMove-e;if(this.partFrame=1-i/t,i>=0)return;this.partFrame=0}this.snakeBoard.getState()!=State.Paused&&(this.snakeBoard.step(),this.highscore.updateScore(this.snake.length())),this.nextMove=e+t},draw:function(){var e=this.snake,t=this.snakeBoard,i=this.context;if(i.save(),this.clear(),this.headCentre=e.getPart(1),i.x0=(0-this.headCentre.getX()+1.5*this.snakeBoard.boardWidth)%this.snakeBoard.boardWidth,i.y0=(0-this.headCentre.getY()+1.5*this.snakeBoard.boardHeight)%this.snakeBoard.boardHeight,t.getState()==State.Running&&!e.getHead().isDeathMarker()){var a=e.getHead().getPlacementDirection();switch(a){case Direction.Left:i.x0+=this.partFrame;break;case Direction.Right:i.x0-=this.partFrame;break;case Direction.Down:i.y0-=this.partFrame;break;case Direction.Up:i.y0+=this.partFrame}}i.x0px=i.x0*this.snakeBlockSize,i.y0px=i.y0*this.snakeBlockSize,this.drawables.draw(i);var o=this.controlOffset;this.stick.drawAt(i,o,320-o),this.stick.drawAt(i,320-o,320-o);var s=this.snakeBoard.getLives(),r=this.highscore.getHighScore()==this.snake.length(),n=-80;if(t.getState()==State.Paused)if(i.textAlign="center",this.snakeBoard.isDead())i.fillStyle=r?Config.highScoreColor:Config.gameOverTextColor,this.setFontSize(30),this.strokeText(Config.textStroke,r?Config.highScoreColor:Config.gameOverTextColor,r?"New High Score":"Game over",160,160+n),this.setFontSize(20),this.strokeText(Config.textStroke,r?Config.highScoreColor:Config.gameOverTextColor,"Double tap to restart",160,185+n);else{i.fillStyle=Config.pauseTextColor,this.setFontSize(30);var h=s>1?s+" lives left":s+" life left";this.strokeText(Config.textStroke,Config.pauseTextColor,h,160,160+n),this.setFontSize(20),this.strokeText(Config.textStroke,Config.pauseTextColor,"Swipe to resume",160,185+n)}i.textAlign="end",this.setFontSize(20),this.strokeText(Config.textStroke,r?Config.highScoreColor:Config.nonHighScoreColor,""+this.snake.length(),315,20),this.setFontSize(15),this.strokeText(Config.textStroke,r?Config.highScoreColor:Config.nonHighScoreColor,""+this.highscore.getHighScore(),315,40),i.x0=0,i.y0=0;for(var l=0;s>l;l++)this.gridDrawer.draw(i,l,0,this.livesDrawable);i.restore()},fonts:new Array,establishFonts:function(){this.fonts[10]=this.isChrome?"10px Verdana":"10px Samsung Sans",this.fonts[15]=this.isChrome?"15px Verdana":"15px Samsung Sans",this.fonts[20]=this.isChrome?"20px Verdana":"20px Samsung Sans",this.fonts[30]=this.isChrome?"30px Verdana":"30px Samsung Sans"},setFontSize:function(e){this.context.font=this.fonts[e]},strokeText:function(e,t,i,a,o){var s=this.context;s.lineWidth=2,s.strokeStyle=e,s.strokeText(i,a,o),s.fillStyle=t,s.fillText(i,a,o),s.lineWidth=1}};window.onload=function(){Game.canvas=document.querySelector("#gameArea"),Game.watch=document.querySelector("#watch"),Game.title=document.querySelector("#title"),Game.context=Game.canvas.getContext("2d");var e=document.width;void 0==document.width&&(e=320),Game.clockRadius=e/2,Game.canvas.width=e,Game.canvas.height=e,window.addEventListener("tizenhwkey",function(e){"back"==e.keyName&&Game.localData.write("game",(new GameSerializer).serialize(Game.snakeBoard)),tizen.application.getCurrentApplication().exit()}),hookUpBrowseKeyPress(),Game.init(),gameLoop()};
function GameSerializer(){var e=function(e){for(var a=[],r=0;r<e.boardHeight;r++)for(var i=0;i<e.boardWidth;i++)e.grid(i,r)instanceof Apple&&a.push({ax:i,ay:r});return a},a=function(e){for(var a=[],r=0;r<e.snake.length();r++){var i=e.snake.getPart(r);a.push({sx:i.getX(),sy:i.getY(),d:i.getPlacementDirection(),dm:i.isDeathMarker()})}return a};this.serialize=function(r){var i={lives:r.getLives(),width:r.boardWidth,height:r.boardHeight,apples:e(r),snake:a(r)};return JSON.stringify(i)},this.deserialize=function(e){var a=JSON.parse(e),r=new SnakeGame({boardWidth:a.width,boardHeight:a.height,lives:a.lives,initialSize:0});for(var i in a.apples){var t=a.apples[i];r.placeApple(t.ax,t.ay)}for(var n in a.snake){var s=a.snake[n];r.snake.addPart(s.sx,s.sy,s.d).setDeathMarker(s.dm)}return r.snake.updateGameboard(),r}}
function HighScore(r){var i;this.getHighScore=function(){return void 0===i&&(i=e()),i};var e=function(){var i=r.read("highscore");return null===i?0:i};this.updateScore=function(e){e<=this.getHighScore()||(i=e,r.write("highscore",e))}}
function LocalData(){var t=window.localStorage;this.write=function(e,i){void 0===i?t.setItem(e,null):t.setItem(e,JSON.stringify(i))},this.read=function(e){var i=t.getItem(e);return JSON.parse(i)},this.clear=function(){t.clear()}}
function ApplesDrawable(r,a,i){this.draw=function(o){for(var d=0;d<r.boardHeight;d++)for(var n=0;n<r.boardWidth;n++)r.grid(n,d)instanceof Apple&&a.draw(o,n,d,i)}}
function Bitmap(t,e){var n=document.createElement("CANVAS");n.setAttribute("width",t),n.setAttribute("height",e),this.canvas=n,this.context=n.getContext("2d"),this.draw=function(t){t.drawImage(this.canvas,0,0)},this.load=function(t){var e=this.context,n=new Image;n.onload=function(){e.drawImage(n,0,0)},n.src=t}}
function ControlStickDrawable(){function t(t,r){t.beginPath();var n=e;t.arc(0,0,n,0,2*Math.PI),t.strokeStyle=r?"#cfcf00":"#cf00cf",t.stroke()}function r(t){t.beginPath();var r=n;t.arc(0,0,r,0,2*Math.PI),t.strokeStyle="#9f009f",t.stroke()}var n=30,i=10,e=n-i,a=i*i,s=0,o=0,u=0,c=0;this.getX=function(){return s},this.getY=function(){return o},this.setPosition=function(t,r){s=t,o=r;var n=t*t+r*r;return n>=a},this.getDrawX=function(){return u},this.getDrawY=function(){return c},this.setDrawPosition=function(t,r){u=t,c=r},this.draw=function(t){this.drawAt(t,u,c)},this.drawAt=function(n,e,u){n.save(),n.translate(e,u),r(n);var c=s,f=o,h=c*c+f*f,g=!1;if(h>a){var v=Math.sqrt(h),w=i/v;c*=w,f*=w,g=!0}n.translate(c,f),t(n,g),n.restore()},this.getOuterRadius=function(){return n}}
function GridDrawable(o){this.color=void 0===o.color?"#7f7f7f":o.color,this.size=void 0===o.size?10:o.size,this.draw=function(o){var i=this.size;o.save(),o.strokeStyle=this.color;var e=0,r=0;void 0!==o.x0px&&(e=o.x0px%i),void 0!==o.y0px&&(r=o.y0px%i);for(var s=r;320>=s;s+=i)o.beginPath(),o.moveTo(0,s),o.lineTo(320,s),o.stroke();for(var t=e;320>=t;t+=i)o.beginPath(),o.moveTo(t,0),o.lineTo(t,320),o.stroke();o.restore()}}
function GridDrawer(e,i){var t=e-1;this.drawRectangle=function(o,n,a,l){n=(n+o.x0)%i.width,a=(a+o.y0)%i.height,o.save(),o.translate(e*n,e*a),o.beginPath(),o.moveTo(0,0),o.lineTo(t,0),o.lineTo(t,t),o.lineTo(0,t),o.fillStyle=l,o.fill(),o.restore()},this.drawTriangle=function(o,n,a,l,r){switch(n=(n+o.x0)%i.width,a=(a+o.y0)%i.height,o.save(),o.translate(e*n,e*a),o.beginPath(),r){case Direction.Down:o.moveTo(0,0),o.lineTo(t,0),o.lineTo(t/2,t);break;case Direction.Up:o.moveTo(0,t),o.lineTo(t,t),o.lineTo(t/2,0);break;case Direction.Right:o.moveTo(0,0),o.lineTo(t,t/2),o.lineTo(0,t);break;case Direction.Left:o.moveTo(t,0),o.lineTo(t,t),o.lineTo(0,t/2)}o.fillStyle=l,o.fill(),o.restore()},this.draw=function(t,o,n,a){o=(o+t.x0)%i.width,n=(n+t.y0)%i.height,t.save(),t.translate(e*o,e*n),a.draw(t),t.restore()}}
function ListDrawable(){var n=[];this.add=function(t){n.push(t)},this.clear=function(){n=[]},this.draw=function(t){for(var a=0;a<n.length;a++)n[a].draw(t)}}
function SnakeDrawable(e,a){this.draw=function(t){for(var r=0;r<e.length();r++){var n=e.getPart(r);a.drawTriangle(t,n.getX(),n.getY(),n.isDeathMarker()?"#ff0000":"#0000ff",n.getPlacementDirection())}}}
function Apple(){}
function Snake(t,i){var e=t.boardWidth,n=t.boardHeight,r=t.initialSize;this.updateGameboard=function(){if(void 0!==i)for(var t=0;t<s.length;t++){var e=s[t];i.place(e.getX(),e.getY(),e)}};var o=new function(){this.direction=Direction.Up,this.nextDirection=null,this.lastDirection=Direction.Up,this.consumed=!0,this.setFirstDirection=function(t){return this.opposite(t)==this.lastDirection?!1:(this.direction=t,this.nextDirection=null,this.consumed=!1,!0)},this.peek=function(){return this.direction},this.consume=function(){this.lastDirection=this.direction,this.consumed=!0,null!==this.nextDirection&&(this.direction=this.nextDirection,this.nextDirection=null)},this.push=function(t){return this.consumed?this.setFirstDirection(t):t==this.direction?!0:this.opposite(t)==this.direction?this.setFirstDirection(t):(this.nextDirection=t,!0)},this.opposite=function(t){switch(t){case Direction.Up:return Direction.Down;case Direction.Down:return Direction.Up;case Direction.Left:return Direction.Right;case Direction.Right:return Direction.Left}},this.reset=function(){this.nextDirection=null,this.consumed=!0}};void 0===r&&(r=3);var s=[];this.addPart=function(t,i,e){var n=new SnakePart(t,i,e);return s.push(n),n};for(var c=0;r>c;c++)this.addPart(10,5+c,Direction.Up);this.updateGameboard(),this.length=function(){return s.length},this.getHead=function(){return s[0]},this.getPart=function(t){return s[t]},this.moveFull=function(){var t=this.getHead(),r=function(i){var r=t.getX(),o=t.getY();return i==Direction.Left?(r--,r=(r+e)%e):i==Direction.Right?(r++,r%=e):i==Direction.Down?(o++,o%=n):i==Direction.Up&&(o--,o=(o+n)%n),new SnakePart(r,o,i)},c=r(o.peek());if(this.canMove(c)){if(o.consume(),s.unshift(c),void 0!==i&&i.grid(c.getX(),c.getY())instanceof Apple)i.consume(c.getX(),c.getY());else{var h=s.pop();void 0!==i&&i.place(h.getX(),h.getY(),void 0)}return void 0!==i&&i.place(c.getX(),c.getY(),c),!0}return this.getHead().setDeathMarker(!0),o.reset(),!1},this.canMove=function(t){return void 0===i?!0:!(i.grid(t.getX(),t.getY())instanceof SnakePart)},this.setDirection=function(t){return o.push(t)},this.getDirection=function(){return o.peek()}}Direction={Up:0,Down:1,Left:2,Right:3};
function SnakeGame(t){function i(t){var e=new Array(t||0),n=t;if(arguments.length>1)for(var r=Array.prototype.slice.call(arguments,1);n--;)e[t-1-n]=i.apply(this,r);return e}this.boardWidth=t.boardWidth,this.boardHeight=t.boardHeight;var e=i(t.boardWidth,t.boardHeight);this.placeApple=function(t,i){return void 0!==this.grid(t,i)?!1:(this.place(t,i,new Apple),!0)},this.insertAppleOnNextBlank=function(t,i){for(var e=0;e<this.boardHeight;e++)for(var n=0;n<this.boardWidth;n++)if(this.placeApple((n+t)%this.boardWidth,(e+i)%this.boardHeight))return!0;return!1},this.placeNApples=function(t){for(var i=0;t>i;i++){var e=Math.floor(Math.random()*this.boardWidth),n=Math.floor(Math.random()*this.boardHeight);if(!this.insertAppleOnNextBlank(e,n))return!1}return!0};var n=!1;this.consume=function(t,i){e[t][i]=void 0,n=!0},this.grid=function(t,i){return e[t][i]},this.place=function(t,i,n){e[t][i]=n},this.snake=new Snake(t,this);var r=State.Running;this.getState=function(){return r},this.pause=function(){r=State.Paused},this.resume=function(){r=State.Running};var s=t.lives;void 0===t.lives&&(s=3),this.loseLife=function(){s--},this.getLives=function(){return s},this.isDead=function(){return 0>=s};var a=void 0;this.step=function(){if(n=!1,void 0!==a&&a==this.snake.getDirection())return!1;a=void 0,this.resume();var t=this.snake.moveFull();return t?n&&0===this.countApples()&&(this.placeNApples(10),3>s&&s++):(this.pause(),this.loseLife(),a=this.snake.getDirection()),t},this.setDirection=function(t){return void 0!==a&&a==t?!1:this.snake.setDirection(t)},this.countApples=function(){for(var t=0,i=0;i<this.boardWidth;i++)for(var e=0;e<this.boardHeight;e++)this.grid(i,e)instanceof Apple&&t++;return t}}State={Paused:0,Running:1};
function SnakePart(t,n,e){var r=!1;this.getX=function(){return t},this.getY=function(){return n},this.setDeathMarker=function(t){r=t},this.isDeathMarker=function(){return r},this.getPlacementDirection=function(){return e}}